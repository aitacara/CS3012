<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

</style>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script>
// dataprocessing: Create graph json from github api data
var graph = '{"nodes":[], "edges":[]}';
var obj = JSON.parse(graph);


var parent_index = 0
d3.json("https://api.github.com/users/octocat/followers", function(error, data) {
    var q = queue();
    for (var i=1; i<data.length; i++){
    	var filename = data[i].followers_url;
        var uname =data[i].login;
        obj['nodes'].push({uname});
        	console.log( filename)
        	q = q.defer(d3.json, filename);
        }
        q.await(onDataLoaded);
});

function onDataLoaded(error) {
    if (!error) {
        for (var i=1; i<arguments.length; i++){
            var children = arguments[i];
            console.log( obj['nodes'])
            indexOf(obj['nodes'], 1)
            for (var j=1; j<children.length; j++){
                var uname = children[j].login;
                var position = indexOf(obj['nodes'], uname);
                if(position === -1){
                    console.log( {uname})
                    obj['nodes'].push({uname}); 
                }else{
                    var source =i;
                    var target =j;
                    obj['edges']. push({source,target});
                    //obj['nodes'].push({"teamId":"4","status":"pending"});
                    console.log(obj['edges'])
                }
            } 
    }
        // or slice them into an array:
        //var jsons = Array.prototype.slice.call(arguments, 1);
    } else { console.log("load error") }

jsonStr = JSON.stringify(obj);
console.log(jsonStr)

function indexOf(array, item) {
    for (var i = 1; i < array.length; i++) {
        if (array[i].uname === item){
            return i;
            }    
    }
    return -1;
}
}
</script>